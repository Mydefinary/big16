# 서버 포트 설정
server:
  port: 8000

# Spring Cloud Gateway 설정
spring:
  cloud:
    gateway:
      # 전역 CORS(Cross-Origin Resource Sharing) 설정
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "http://20.249.154.2"
            allowedMethods:
              - GET
              - POST
              - PUT
              - PATCH
              - DELETE
              - OPTIONS
            allowedHeaders: "*"
            maxAge: 3600

      # 라우팅 규칙 정의
      routes:
        # ===================================================
        # 1. 인증/인가 (Auth) 서비스 라우팅 (인증 불필요)
        # ===================================================
        - id: auth-service
          uri: lb://auth-backend-service
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
          order: 0

        # ===================================================
        # 2. ✅ [수정] 사용자 정보 (User) 서비스 라우팅 분리 및 개별 경로 지정
        # ===================================================
        # 2-1. 회원가입 경로 (인증 불필요)
        - id: user-register-route
          uri: lb://user-backend-service
          predicates:
            - Path=/api/users/register
          filters:
            - StripPrefix=1
          order: 1

        # 2-2. 이메일 중복 확인 경로 (인증 불필요)
        - id: user-check-email-route
          uri: lb://user-backend-service
          predicates:
            - Path=/api/users/check-email
          filters:
            - StripPrefix=1
          order: 1

        # 2-3. 아이디 찾기 경로 (인증 불필요)
        - id: user-find-id-route
          uri: lb://user-backend-service
          predicates:
            - Path=/api/users/find-id
          filters:
            - StripPrefix=1
          order: 1

        # 2-4. 인증이 필요한 나머지 User API 경로
        - id: user-secure-routes
          uri: lb://user-backend-service
          predicates:
            - Path=/api/users/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=1
          order: 2

        # ===================================================
        # 3. PPL 생성기 서비스 라우팅 (인증 필요)
        # ===================================================
        - id: ppl-gen-service
          uri: lb://ppl-gen-backend-service
          predicates:
            - Path=/api/ppl-gen/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 10

        # ===================================================
        # 4. 굿즈 생성기 서비스 라우팅 (인증 필요)
        # ===================================================
        - id: goods-gen-service
          uri: lb://goods-gen-backend-service
          predicates:
            - Path=/api/goods-gen/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 11

        # ===================================================
        # 5. 웹툰 대시보드 서비스 라우팅 (인증 필요)
        # ===================================================
        - id: webtoon-dashboard-service
          uri: lb://webtoon-dashboard-backend-service
          predicates:
            - Path=/api/webtoon/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 12

      # default-filters 설정 (기존과 동일)
      default-filters:
        - name: JwtAuthenticationFilter
          args:
            secretKey: ${JWT_SECRET}
