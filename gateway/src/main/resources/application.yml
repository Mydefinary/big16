# gateway/src/main/resources/application.yml

server:
  port: 8000

spring:
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins: "http://20.249.154.2"
            allowedMethods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600
      discovery:
        locator:
          enabled: false

      routes:
        # ===================================================
        # 1. 인증 서비스 - 공개 경로 (인증 불필요)
        # ===================================================
        - id: auth-public-routes
          uri: http://auth-backend-service-hoa:8080
          predicates:
            - Path=/api/auths/login, /api/auths/register, /api/auths/verify-code, /api/auths/resend-code, /api/auths/check-email, /api/auths/check-login-id, /api/auths/refresh, /api/auths/reset-password, /api/auths/health, /api/auths/save-password, /api/auths/test-login, /api/auths/safe-login, /api/auths/check-user/**
          filters:
            - StripPrefix=1
          order: 0

        # ===================================================
        # 2. 사용자 서비스 - 공개 경로 (인증 불필요)
        # ===================================================
        - id: user-public-routes
          uri: http://user-backend-service-hoa:8081
          predicates:
            - Path=/api/users/register, /api/users/check-email, /api/users/find-id, /api/users/health, /api/users/test-json, /api/users/test-complex
          filters:
            - StripPrefix=1
          order: 1

        # ===================================================
        # 3. 인증 서비스 - 보호된 경로 (인증 필요)
        # ===================================================
        - id: auth-secure-routes
          uri: http://auth-backend-service-hoa:8080
          predicates:
            - Path=/api/auths/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=1
          order: 2

        # ===================================================
        # 4. 사용자 서비스 - 보호된 경로 (인증 필요)
        # ===================================================
        - id: user-secure-routes
          uri: http://user-backend-service-hoa:8081
          predicates:
            - Path=/api/users/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=1
          order: 3

        # ===================================================
        # 기타 서비스들...
        # ===================================================
        - id: ppl-gen-service
          uri: http://ppl-gen-backend-service:8080
          predicates:
            - Path=/api/ppl-gen/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 10

        - id: goods-gen-service
          uri: http://goods-gen-backend-service:8080
          predicates:
            - Path=/api/goods-gen/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 11

        - id: webtoon-dashboard-service
          uri: http://webtoon-dashboard-backend-service:8080
          predicates:
            - Path=/api/webtoon/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 12

        - id: webtoon-hl-service
          uri: http://webtoon-hl-backend-service:8080
          predicates:
            - Path=/api/webtoon-hl/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 13

        - id: board-service
          uri: http://board-backend-service:8080
          predicates:
            - Path=/api/board/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 14

        - id: chatbot-service
          uri: http://chatbot-backend-service:8080
          predicates:
            - Path=/api/chatbot/**
          filters:
            - name: JwtAuthenticationFilter
            - StripPrefix=2
          order: 15


jwt:
  secret: ${JWT_SECRET:your-super-secret-jwt-key-here-make-it-long-and-secure-at-least-32-characters}